<div class="row">

  <!-- início do datepicker -->
  <div class="col-4">

    <label>Pesquisar por data</label>

    <div class="input-group">
      <input class="form-control" name="dp" ngbDatepicker #d="ngbDatepicker" name="busca_data" [(ngModel)]="inputDate" (ngModelChange)="getAllFuncionarios()">
      <button class="input-group-addon" (click)="d.toggle()" type="button">
        <i class="ion-calendar"></i>
      </button>
    </div>

  </div>
  <!-- fim do datepicker -->

  <!-- início da seleção dos funcionário -->
  <div class="col-6 pt-3">

    <div class="btn-group" ngbDropdown>

      <button class="btn btn-primary btn-dropdown d-flex" ngbDropdownToggle>
        <!-- <img *ngIf="funcionarioSelecionado" [src]="funcionarioSelecionado?.foto_url ? funcionarioSelecionado?.foto_url : '/assets/img/avatar.png'"> -->
        <h5 *ngIf="!funcionarioSelecionado">Técnicos</h5>
        <h5>{{ funcionarioSelecionado?.nome }}</h5>
      </button>

      <div class="dropdown-menu scrollbar" id="style-1" ngbDropdownMenu>
        <button class="dropdown-item d-flex" *ngFor="let funcionario of funcionarios$ | async" (click)="funcionarioSelecionado = funcionario">
          <img [src]="funcionario?.foto_url ? funcionario?.foto_url : '/assets/img/avatar.png'" alt="Foto do Técnico">
          <h6>{{ funcionario?.nome }}</h6>
        </button>
      </div>

    </div>
  </div>

  <div class="col-2 pt-3 text-right">
    <button class="btn btn-primary btn-imprimir">
      <i class="fa fa-print"></i>
    </button>
  </div>
  <!-- fim da seleção dos funcionários -->


  <!-- início da tabela -->

  <div class="col-12 text-center semKM" *ngIf="!funcionarioSelecionado">
    <div class=" text-center">
      <img src="assets/icons/map.svg" width='100px' height='auto'>
      <h1 class='mt-4'>Selecione o período e o técnico!</h1>
    </div>
  </div>

  <div class="col-12 text-center" *ngIf="funcionarioSelecionado">

      <p-dataTable [value]="funcionarioSelecionado?.monitoramentos" expandableRows="true" (onRowExpand)="($event.data)">

       <p-column expander="true" styleClass="col-icon" [style]="{'width':'50px'}"></p-column>
       <p-column field="tipo" header="Tipo"></p-column>

      <p-column field="km_inicial" header="Km Início">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.km_inicial }} Km
        </ng-template>
      </p-column>

      <p-column field="km_final" header="Km Final">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.km_final }} Km
        </ng-template>
      </p-column>

      <p-column field="data_hora_inicial_km" header="Hora KM Início">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.data_hora_inicial_km | date: 'HH' }}h
          {{ monitoramento?.data_hora_inicial_km | date: 'mm' }}m
        </ng-template>
      </p-column>

      <p-column field="data_hora_final_km" header="Hora KM Início">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.data_hora_final_km | date: 'HH' }}h
          {{ monitoramento?.data_hora_final_km | date: 'mm' }}m
        </ng-template>
      </p-column>

      <p-column field="total_km_deslocamento" header="Km Total">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.total_km_deslocamento }} Km
        </ng-template>
      </p-column>

      <p-column field="tempo_deslocamento" header="Tempo Deslocamento"></p-column>

      <p-column field="inicio" header="Início">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.data_hora_inicial_virgente_local | date: 'HH' }}h
          {{ monitoramento?.data_hora_inicial_virgente_local | date: 'mm' }}m
        </ng-template>
      </p-column>

      <p-column field="fim" header="Fim">
        <ng-template let-monitoramento="rowData" pTemplate="body">
          {{ monitoramento?.data_hora_final_virgente_local | date: 'HH' }}h
          {{ monitoramento?.data_hora_final_virgente_local | date: 'mm' }}m
        </ng-template>
      </p-column>

      <p-column field="duracao_evento" header="Duração"></p-column>

      <ng-template let-monitoramento pTemplate="rowexpansion" rowExpandMode="single">
          <div class="ui-grid ui-grid-responsive ui-fluid" style="font-size:16px;padding:20px">
              <div class="ui-grid-row">
                  <div class="ui-grid-col-3" style="text-align:center"></div>
                  <div class="ui-grid-col-9">
                      <div class="ui-grid ui-grid-responsive ui-grid-pad">

                         <div class="ui-grid-row">
                              <div class="ui-grid-col-2 label">Razão Social/Nome: </div>
                              <div class="ui-grid-col-10">{{ monitoramento | json }}</div>
                          </div>
                          <!-- <div class="ui-grid-row">
                              <div class="ui-grid-col-2 label">Cnpj/Cpf: </div>
                              <div class="ui-grid-col-10">{{monitoramento.year}}</div>
                          </div>
                          <div class="ui-grid-row">
                              <div class="ui-grid-col-2 label">Contato: </div>
                              <div class="ui-grid-col-10">{{monitoramento.brand}}</div>
                          </div>  -->
                      </div>
                  </div>
              </div>
          </div>
      </ng-template>

    </p-dataTable>

  </div>
</div>
